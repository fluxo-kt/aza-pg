# PostgreSQL 18 Base Configuration
# ============================================
# Shared settings across all aza-pg deployments (primary, replica, single).
# This file is included by stack-specific configs via:
#   include = '/etc/postgresql/postgresql-base.conf'
#
# Stack-specific configs should ONLY contain deployment-unique settings:
#   - primary: replication settings, synchronous_commit, max_wal_senders
#   - replica: hot_standby delays, max_standby_*, no pg_cron
#   - single: simplified WAL settings, no replication
#
# Auto-config overrides: Runtime settings (shared_buffers, max_connections, work_mem)
# are dynamically set by docker-auto-config-entrypoint.sh based on container RAM/CPU.

# Connection Settings
listen_addresses = '*'

# PostgreSQL 18 Asynchronous I/O (2-3x performance improvement)
io_method = 'worker'
io_combine_limit = 128
io_max_combine_limit = 128

# TLS/SSL Configuration (uncomment to enable)
# Generate certs: scripts/tools/generate-ssl-certs.sh stacks/{primary|replica|single}/certs
# Mount in compose.yml: - ./certs:/etc/postgresql/certs:ro
# ssl = on
# ssl_cert_file = '/etc/postgresql/certs/server.crt'
# ssl_key_file = '/etc/postgresql/certs/server.key'
# ssl_ca_file = '/etc/postgresql/certs/ca.crt'
# ssl_min_protocol_version = 'TLSv1.3'  # PostgreSQL 18 supports TLS 1.3
# ssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL'
# ssl_prefer_server_ciphers = on
# ssl_tls13_ciphers = 'TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256'  # PostgreSQL 18

# Logging Configuration
log_destination = 'stderr'
logging_collector = off
log_min_duration_statement = 1000
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_lock_waits = on
log_temp_files = 0

# Locale and Timezone Settings
timezone = 'UTC'
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'
default_text_search_config = 'pg_catalog.english'

# pg_stat_statements Configuration
pg_stat_statements.max = 10000
pg_stat_statements.track = all

# auto_explain Configuration
auto_explain.log_min_duration = '3s'
auto_explain.log_analyze = on
auto_explain.log_buffers = on
auto_explain.log_nested_statements = on

# Autovacuum Base Settings (SSD-optimized)
autovacuum = on
autovacuum_naptime = 1min
autovacuum_vacuum_cost_delay = 2ms
autovacuum_vacuum_cost_limit = 2000

# Checkpoint Settings
checkpoint_completion_target = 0.9

# WAL Settings (common baseline)
wal_level = replica
