# PostgreSQL Replica Configuration
# Stack-specific settings for read-only replica.
# Common settings loaded from base config.
# Auto-config settings (shared_buffers, max_connections, etc.) are overridden at runtime
# by docker-auto-config-entrypoint.sh based on available RAM/CPU
include = '/etc/postgresql/postgresql-base.conf'

# Replica-Specific Connection Settings
max_connections = 200

# Hot Standby Settings (REPLICA-SPECIFIC: read-only replica)
hot_standby = on
hot_standby_feedback = on
max_standby_streaming_delay = 30s
max_standby_archive_delay = 60s

# Extension Loading (REPLICA-SPECIFIC: pg_cron removed - doesn't work on read-only replicas)
shared_preload_libraries = 'pg_stat_statements,pgaudit,auto_explain'

# Logging Settings (REPLICA-SPECIFIC: additional logging for replication monitoring)
log_checkpoints = on
log_connections = on
log_disconnections = on
log_autovacuum_min_duration = 0
log_error_verbosity = default
log_replication_commands = on

# auto_explain Settings (REPLICA-SPECIFIC: more verbose than primary)
auto_explain.log_timing = on
auto_explain.log_triggers = on
auto_explain.log_verbose = off

# pgAudit Settings (REPLICA-SPECIFIC: minimal logging)
pgaudit.log = 'none'

# Autovacuum Settings (REPLICA-SPECIFIC: reduced workers, still needed for temp tables)
autovacuum_max_workers = 2

# Checkpoint Settings (REPLICA-SPECIFIC: longer timeout for replicas)
checkpoint_timeout = 30min

# WAL Settings (REPLICA-SPECIFIC: receives WAL, doesn't generate)
max_wal_senders = 0
archive_mode = off

# Recovery Settings (REPLICA-SPECIFIC: standby mode)
# NOTE: primary_conninfo and primary_slot_name are automatically written to
# postgresql.auto.conf by pg_basebackup -R during replica setup.
# Do NOT set them here - they will be populated with actual runtime values.

# Time Zone Settings (REPLICA-SPECIFIC: adds log_timezone)
log_timezone = 'UTC'

# Parallel Worker Settings (REPLICA-SPECIFIC: must match or exceed primary)
max_worker_processes = 28
max_parallel_workers = 14
max_parallel_workers_per_gather = 7
