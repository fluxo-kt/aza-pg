# PostgreSQL Replica Configuration
# Auto-config settings (shared_buffers, max_connections, etc.) are overridden at runtime
# by docker-auto-config-entrypoint.sh based on available RAM/CPU

# Connection Settings
listen_addresses = '*'
max_connections = 100

# Hot Standby Settings (read-only replica)
hot_standby = on
hot_standby_feedback = on
max_standby_streaming_delay = 30s
max_standby_archive_delay = 60s

# Extensions (loaded at startup, created in init scripts)
shared_preload_libraries = 'pg_stat_statements,pg_cron,pgaudit,auto_explain'

# pg_cron Settings (read-only on replica, jobs won't execute)
cron.database_name = 'postgres'
cron.use_background_workers = on

# Logging
log_destination = 'stderr'
logging_collector = off
log_min_duration_statement = 1000
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_temp_files = 0
log_autovacuum_min_duration = 0
log_error_verbosity = default
log_replication_commands = on

# Query Performance
pg_stat_statements.max = 10000
pg_stat_statements.track = all
auto_explain.log_min_duration = '3s'
auto_explain.log_analyze = on
auto_explain.log_buffers = on
auto_explain.log_timing = on
auto_explain.log_triggers = on
auto_explain.log_verbose = off
auto_explain.log_nested_statements = on

# pgAudit (adjust as needed, default: log nothing)
pgaudit.log = 'none'

# Autovacuum (still needed for replica to clean up temporary tables)
autovacuum = on
autovacuum_max_workers = 2
autovacuum_naptime = 1min

# Checkpoints (replica replays WAL, doesn't create checkpoints as frequently)
checkpoint_timeout = 30min
checkpoint_completion_target = 0.9

# WAL Settings (replica receives WAL, doesn't generate)
wal_level = replica
max_wal_senders = 0
archive_mode = off

# Recovery Settings (standby mode)
primary_conninfo = 'host=${PRIMARY_HOST} port=${PRIMARY_PORT} user=${PG_REPLICATION_USER} password=${PG_REPLICATION_PASSWORD} application_name=replica_1'
primary_slot_name = 'replica_slot_1'
restore_command = ''

# Time Zones
timezone = 'UTC'
log_timezone = 'UTC'

# Locale
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'
default_text_search_config = 'pg_catalog.english'
