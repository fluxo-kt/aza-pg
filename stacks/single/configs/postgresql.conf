# PostgreSQL Single Instance Configuration
# Stack-specific settings for standalone (non-replicated) deployment.
# Common settings loaded from base config.
# Auto-config settings (shared_buffers, max_connections, etc.) are overridden at runtime
# by docker-auto-config-entrypoint.sh based on available RAM/CPU
include = '/etc/postgresql/postgresql-base.conf'

# Single-Specific Connection Settings
max_connections = 100

# Extension Loading (SINGLE-SPECIFIC: includes pg_cron)
shared_preload_libraries = 'pg_stat_statements,pg_cron,pgaudit,auto_explain'

# pg_cron Settings (SINGLE-SPECIFIC: doesn't work on replicas)
cron.database_name = 'postgres'
cron.use_background_workers = on

# Logging Settings (SINGLE-SPECIFIC: additional logging)
log_checkpoints = on
log_connections = on
log_disconnections = on
log_autovacuum_min_duration = 0
log_error_verbosity = default

# auto_explain Settings (SINGLE-SPECIFIC: more verbose)
auto_explain.log_timing = on
auto_explain.log_triggers = on
auto_explain.log_verbose = off

# pgAudit Settings (SINGLE-SPECIFIC: minimal logging)
pgaudit.log = 'none'

# Autovacuum Settings (SINGLE-SPECIFIC)
autovacuum_max_workers = 3
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50
autovacuum_vacuum_scale_factor = 0.2
autovacuum_analyze_scale_factor = 0.1

# Checkpoint Settings (SINGLE-SPECIFIC: shorter timeout)
checkpoint_timeout = 15min
min_wal_size = 1GB
max_wal_size = 4GB

# WAL Settings (SINGLE-SPECIFIC: no replication)
archive_mode = off

# Time Zone Settings (SINGLE-SPECIFIC: adds log_timezone)
log_timezone = 'UTC'
